import React, { useState, useEffect } from "react";
import {
  ClipboardList, Video, Users, Target, BarChart2, Zap,
  CheckCircle, Play, Pause, AlertCircle, RefreshCw,
  Search, Filter, Plus, ChevronDown, ChevronRight,
  MessageSquare, DollarSign, TrendingUp // Added missing icons
} from "lucide-react";
import api from "../lib/api";
import { Lead } from "../types";

const TABS = [
  { id: "sop", label: "SOPs", icon: <ClipboardList size={16} /> },
  { id: "content", label: "Content Engine", icon: <Video size={16} /> },
  { id: "accounts", label: "Account Ops", icon: <Users size={16} /> },
  { id: "outreach", label: "Outreach CRM", icon: <Target size={16} /> },
  { id: "analytics", label: "Analytics", icon: <BarChart2 size={16} /> },
  { id: "yokaizen", label: "Yokaizen Adapt", icon: <Zap size={16} /> },
];

const sops = [
  {
    id: "sop-1",
    title: "AI Identity Training",
    category: "Setup",
    priority: "critical",
    time: "4-6 hours",
    steps: [
      { text: "Record 2+ hours of footage across 5+ locations (natural light, studio, outdoor, car, office)", done: false },
      { text: "Capture 3 emotional ranges per location: casual/friendly, authoritative/professional, excited/passionate", done: false },
      { text: "Record 20+ different outfits to maximize variation pool", done: false },
      { text: "Film both static (sitting/standing) and dynamic (walking/driving/gesturing) footage", done: false },
      { text: "Capture voice-only audio in 10+ different tones for voice cloning refinement", done: false },
      { text: "Upload full dataset to Grok Imagine 1 and run initial avatar generation", done: false },
      { text: "Quality check: compare 10 test outputs against real footage ‚Äî aim for 95%+ indistinguishability", done: false },
      { text: "Create avatar preset library: 'Professional', 'Casual', 'High-Energy', 'Intimate/1-on-1'", done: false },
    ],
  },
  {
    id: "sop-2",
    title: "Script Variation Engine",
    category: "Content",
    priority: "high",
    time: "2-3 hours/campaign",
    steps: [
      { text: "Define campaign objective: awareness / lead gen / re-engagement / conversion", done: false },
      { text: "Feed Claude your top 10 performing scripts + brand voice doc + audience psychographics", done: false },
      { text: "Generate 15 hook variations (pattern interrupt, question, bold claim, story, stat)", done: false },
      { text: "Generate 10 body variations per hook (different stories, proof points, framings)", done: false },
      { text: "Generate 8 CTA variations (soft ask, urgency, curiosity, direct)", done: false },
      { text: "Combine into 15 complete scripts (mix-match best hooks/bodies/CTAs)", done: false },
      { text: "A/B tag each script for tracking: HOOK-01_BODY-03_CTA-02 format", done: false },
      { text: "VA review pass: flag anything that sounds unnatural when spoken aloud", done: false },
    ],
  },
  {
    id: "sop-3",
    title: "Prospect Profiling Protocol",
    category: "Outreach",
    priority: "high",
    time: "30 min/prospect",
    steps: [
      { text: "Define ICP: age range, industry, wealth indicators, geographic location, platform presence", done: false },
      { text: "Source prospects from LinkedIn Sales Nav, IG verified accounts, public records, podcast guests", done: false },
      { text: "For each prospect, document: full name, company, role, recent activity, public interests", done: false },
      { text: "Find 2-3 personalization anchors: recent deal, podcast quote, shared connection, property purchase", done: false },
      { text: "Download prospect photo from LinkedIn/IG (high-res, clear face)", done: false },
      { text: "Run photo through Nano Banana Pro: add lifestyle elements matching prospect's aspirational identity", done: false },
      { text: "Score prospect 1-5 on: likelihood to respond, deal size potential, network value", done: false },
      { text: "Add to prospect database with all fields populated ‚Äî no incomplete profiles", done: false },
    ],
  },
  {
    id: "sop-4",
    title: "Ghost Follow-Up Video Production",
    category: "Outreach",
    priority: "critical",
    time: "15 min/video",
    steps: [
      { text: "Pull prospect from 'Ghosted 2+ weeks' segment in CRM", done: false },
      { text: "Select scenario matching prospect's aspirational lifestyle (car, yacht, beach, etc.)", done: false },
      { text: "Load prospect's enhanced photo (from Nano Banana Pro) into Grok Imagine 1", done: false },
      { text: "Load your AI avatar + selected scenario background", done: false },
      { text: "Generate video: you + prospect in aspirational setting, 8-15 seconds", done: false },
      { text: "Quality check: face accuracy, lip sync, natural movement, lighting consistency", done: false },
      { text: "If quality < 90%, regenerate with adjusted prompts (max 3 attempts)", done: false },
      { text: "Pair video with message: 'The type of life you'll live if you reply üèéÔ∏è'", done: false },
      { text: "Send via IG DM at optimal time (Tue-Thu, 10am-2pm prospect's timezone)", done: false },
      { text: "Log in CRM: date sent, scenario used, prospect reaction category", done: false },
    ],
  },
  {
    id: "sop-5",
    title: "Verified Account Network Management",
    category: "Distribution",
    priority: "critical",
    time: "Daily 30 min check",
    steps: [
      { text: "Morning health check: scan all accounts for restriction warnings or action blocks", done: false },
      { text: "Rotate proxy IPs across account clusters (max 5 accounts per IP)", done: false },
      { text: "Verify device fingerprint rotation is active (Nano Banana Pro dashboard)", done: false },
      { text: "Check engagement limits: max 60 follows, 100 likes, 40 comments per account/day", done: false },
      { text: "Review content queue: ensure next 48hrs of content is loaded and scheduled", done: false },
      { text: "Stagger posting times: 3-5 min gaps between accounts, randomized within 2hr window", done: false },
      { text: "Monitor account-level metrics: any account below 500 avg views gets paused for audit", done: false },
      { text: "Weekly: rotate 10% of lowest-performing accounts out, onboard replacements", done: false },
    ],
  },
  {
    id: "sop-6",
    title: "VA Deployment & Training",
    category: "Operations",
    priority: "high",
    time: "1 week onboarding",
    steps: [
      { text: "Hire VA with experience in social media management + basic video editing awareness", done: false },
      { text: "Provide access to: Nano Banana Pro, Grok Imagine 1, prospect database, content calendar", done: false },
      { text: "Walk through each SOP live on video call ‚Äî record for future hires", done: false },
      { text: "VA completes 5 supervised ghost follow-up videos with real-time feedback", done: false },
      { text: "VA completes 10 supervised content deployments across account network", done: false },
      { text: "Set daily standup: 15 min async Loom ‚Äî what was done, blockers, quality flags", done: false },
      { text: "Define escalation protocol: when to pause, when to flag, when to proceed", done: false },
      { text: "Week 1 review: assess quality scores, speed, adherence to SOPs. Adjust or replace.", done: false },
    ],
  },
];

const hookTypes = [
  { type: "Pattern Interrupt", icon: "‚ö°", example: "I just sent this to a CEO who ghosted me for 3 weeks...", color: "#ff3366" },
  { type: "Bold Claim", icon: "üî•", example: "This single DM strategy generated $47K in dead lead revenue last month.", color: "#ff6b35" },
  { type: "Question Hook", icon: "‚ùì", example: "What would you do if you could clone yourself 1000 times?", color: "#ffd700" },
  { type: "Story Open", icon: "üìñ", example: "6 months ago I was manually recording every follow-up video...", color: "#7c4dff" },
  { type: "Stat Bomb", icon: "üìä", example: "31% of people who completely ghosted us replied to this one thing.", color: "#00e5ff" },
];

const scenarioTemplates = [
  { scene: "Highway Cruise", setting: "Driving luxury car on open highway", mood: "Freedom & success", best_for: "Business prospects" },
  { scene: "Beach Life", setting: "Sipping coconuts on tropical beach", mood: "Relaxation & reward", best_for: "Burned-out executives" },
  { scene: "Yacht Party", setting: "Lounging on yacht deck, ocean backdrop", mood: "Luxury & exclusivity", best_for: "High-net-worth targets" },
  { scene: "Dubai Adventure", setting: "Motorcycling through Dubai cityscape", mood: "Adventure & ambition", best_for: "Young entrepreneurs" },
  { scene: "Mountain Summit", setting: "Standing at mountain peak, sunrise", mood: "Achievement & clarity", best_for: "Goal-oriented prospects" },
  { scene: "Private Jet", setting: "Working from private jet cabin", mood: "Ultimate lifestyle", best_for: "C-suite executives" },
];

const yokaizenAdaptations = [
  {
    original: "Ghost Follow-Up for Sales",
    adapted: "Therapeutic Re-Engagement Quests",
    description: "Instead of lifestyle flex videos, generate personalized anime-style quest completion videos. When a Gen Z user drops off the Yokaizen app, send them an AI-generated video of their avatar completing a confidence challenge ‚Äî 'Your quest awaits, [name]. The dragon of self-doubt doesn't stand a chance.'",
    tools: "Sora 2 / VEO 3.1 + Nano Banana Pro + Push Notifications",
    metric: "DAU recovery rate",
  },
  {
    original: "AI Avatar for Cold Outreach",
    adapted: "AI Companion Personality at Scale",
    description: "Train AI companions on therapeutic frameworks (CBT, DBT, motivational interviewing) the same way Solarz trains avatars on his identity. Each companion feels uniquely personal but operates from evidence-based protocols. Scale to millions of concurrent users.",
    tools: "Claude API + Custom voice synthesis + Biometric ring data",
    metric: "Therapeutic outcome scores",
  },
  {
    original: "100+ Verified IG Accounts",
    adapted: "Multi-Platform Anime Content Network",
    description: "Deploy AI-generated anime therapeutic content across TikTok, IG Reels, YouTube Shorts, and X simultaneously. Each platform gets format-optimized versions. The 'stealth therapy' content looks like entertainment but embeds CBT techniques.",
    tools: "WorldForge + Studio G + Sora 2 + Multi-platform scheduler",
    metric: "1M+ views/week organic reach",
  },
  {
    original: "Personalized Video DMs",
    adapted: "Personalized Therapeutic Journey Videos",
    description: "Generate unique anime-style progress videos for each user showing their growth journey. Biometric ring data feeds the AI ‚Äî heart rate improvements, sleep quality gains ‚Äî visualized as their avatar leveling up in the game world.",
    tools: "Grok Imagine + Biometric API + Flutter WebView",
    metric: "User retention & NPS",
  },
  {
    original: "$27 Low-Ticket Funnel",
    adapted: "Freemium ‚Üí Premium Journey",
    description: "Free tier hooks users with AI-generated therapeutic anime content (the 1M view engine). Premium tier ($9.99/mo) unlocks personalized AI companion + biometric integration + custom quest lines. Enterprise tier for corporate wellness programs.",
    tools: "Stripe + Firebase + AI content pipeline",
    metric: "Free-to-paid conversion rate",
  },
  {
    original: "VA-Run Operations",
    adapted: "AI-First Operations with Human Oversight",
    description: "Replace VA-heavy workflows with AI agents that handle content generation, distribution, user engagement, and analytics. Human team focuses on therapeutic protocol design, quality assurance, and edge cases. True AI-native operations.",
    tools: "Claude agents + Nano Banana Pro API + Custom dashboards",
    metric: "Ops cost per user served",
  },
];

const weeklyData = [
  { week: "W1", views: 120000, replies: 34, deals: 4, revenue: 4800 },
  { week: "W2", views: 340000, replies: 89, deals: 11, revenue: 13200 },
  { week: "W3", views: 780000, replies: 156, deals: 19, revenue: 22800 },
  { week: "W4", views: 1200000, replies: 312, deals: 38, revenue: 45600 },
  { week: "W5", views: 1800000, replies: 489, deals: 57, revenue: 68400 },
  { week: "W6", views: 2400000, replies: 623, deals: 74, revenue: 88800 },
  { week: "W7", views: 3100000, replies: 801, deals: 96, revenue: 115200 },
  { week: "W8", views: 4200000, replies: 1034, deals: 124, revenue: 148800 },
];

function BarChart({ data, dataKey, color, label }: any) {
  const max = Math.max(...data.map((d: any) => d[dataKey]));
  return (
    <div>
      <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.4)", letterSpacing: "1px", textTransform: "uppercase", marginBottom: 12 }}>{label}</div>
      <div style={{ display: "flex", alignItems: "flex-end", gap: 6, height: 120 }}>
        {data.map((d: any, i: number) => (
          <div key={i} style={{ flex: 1, display: "flex", flexDirection: "column", alignItems: "center", gap: 4 }}>
            <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)", fontFamily: "'JetBrains Mono', monospace" }}>
              {d[dataKey] >= 1000000 ? (d[dataKey] / 1000000).toFixed(1) + "M" : d[dataKey] >= 1000 ? (d[dataKey] / 1000).toFixed(0) + "K" : d[dataKey]}
            </div>
            <div style={{
              width: "100%",
              height: `${(d[dataKey] / max) * 90}px`,
              background: `linear-gradient(180deg, ${color}, ${color}44)`,
              borderRadius: "4px 4px 0 0",
              transition: "height 0.5s ease",
              minHeight: 4,
            }} />
            <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)", fontFamily: "'JetBrains Mono', monospace" }}>{d.week}</div>
          </div>
        ))}
      </div>
    </div>
  );
}

function Checkbox({ checked, onChange, label }: any) {
  return (
    <div
      onClick={onChange}
      style={{
        display: "flex", alignItems: "flex-start", gap: 12,
        padding: "10px 0",
        cursor: "pointer",
        borderBottom: "1px solid rgba(255,255,255,0.03)",
      }}
    >
      <div style={{
        minWidth: 20, height: 20, borderRadius: 6,
        border: `2px solid ${checked ? "#00ff88" : "rgba(255,255,255,0.15)"}`,
        background: checked ? "rgba(0,255,136,0.15)" : "transparent",
        display: "flex", alignItems: "center", justifyContent: "center",
        transition: "all 0.2s ease",
        marginTop: 1,
      }}>
        {checked && <span style={{ color: "#00ff88", fontSize: 12, fontWeight: 800 }}>‚úì</span>}
      </div>
      <span style={{
        fontSize: 13,
        color: checked ? "rgba(255,255,255,0.3)" : "rgba(255,255,255,0.65)",
        textDecoration: checked ? "line-through" : "none",
        lineHeight: 1.5,
        transition: "all 0.2s ease",
      }}>{label}</span>
    </div>
  );
}

function PriorityBadge({ level }: { level: string }) {
  const colors: Record<string, string> = { critical: "#ff3366", high: "#ff6b35", medium: "#ffd700", low: "#00e5ff" };
  return (
    <span style={{
      background: `${colors[level]}15`,
      border: `1px solid ${colors[level]}30`,
      color: colors[level],
      borderRadius: 6, padding: "3px 10px",
      fontSize: 10, fontWeight: 700,
      textTransform: "uppercase", letterSpacing: "0.5px",
    }}>{level}</span>
  );
}

export default function GrowthEnginePage() {
  const [activeTab, setActiveTab] = useState("sop");
  const [sopState, setSopState] = useState<Record<string, boolean[]>>(() => {
    const state: Record<string, boolean[]> = {};
    sops.forEach((sop) => {
      state[sop.id] = sop.steps.map(() => false);
    });
    return state;
  });
const [expandedSop, setExpandedSop] = useState<string | null>("sop-1");
const [selectedHook, setSelectedHook] = useState(0);
const [selectedScene, setSelectedScene] = useState(0);
const [expandedAdaptation, setExpandedAdaptation] = useState(0);

// Growth Engine Integration State
const [startupId, setStartupId] = useState<string | null>(null);
const [isGenerating, setIsGenerating] = useState(false);
const [generatedAssets, setGeneratedAssets] = useState<any[]>([]);
const [campaignType, setCampaignType] = useState("exit_survey");

// Outreach CRM State
const [leads, setLeads] = useState<Lead[]>([]);
const [isGeneratingOutreach, setIsGeneratingOutreach] = useState(false);
const [lastGeneratedDraft, setLastGeneratedDraft] = useState<{ subject?: string, body: string, leadId: string } | null>(null);

useEffect(() => {
  // Fetch user's startup on mount
  api.getStartups().then(startups => {
    if (startups && startups.length > 0) {
      const id = startups[0].id;
      setStartupId(id);
      // Fetch leads for Outreach CRM
      api.getLeads(id).then(setLeads).catch(console.error);
    }
  }).catch(console.error);
}, []);

const handleGenerateCampaign = async () => {
  if (!startupId) return;
  setIsGenerating(true);
  setGeneratedAssets([]);
  try {
    const results = await api.createViralCampaign({
      startup_id: startupId,
      campaign_type: campaignType,
      platform: "tiktok",
      variations: 1
    });
    setGeneratedAssets(results);
  } catch (err) {
    console.error("Campaign generation failed", err);
  } finally {
    setIsGenerating(false);
  }
};

const handleGenerateOutreach = async (leadId: string) => {
  if (!startupId) return;
  setIsGeneratingOutreach(true);
  try {
    const res = await api.generateOutreach(startupId, leadId, {
      channel: "email",
      tone: "professional",
      objective: "intro"
    });
    setLastGeneratedDraft({ ...res, leadId });
  } catch (err) {
    console.error("Outreach generation failed", err);
  } finally {
    setIsGeneratingOutreach(false);
  }
};

const toggleStep = (sopId: string, stepIdx: number) => {
  setSopState((prev) => {
    const next = { ...prev };
    next[sopId] = [...prev[sopId]];
    next[sopId][stepIdx] = !next[sopId][stepIdx];
    return next;
  });
};

const getSopProgress = (sopId: string) => {
  const steps = sopState[sopId];
  const done = steps.filter(Boolean).length;
  return { done, total: steps.length, pct: Math.round((done / steps.length) * 100) };
};

const totalProgress = () => {
  let done = 0, total = 0;
  Object.values(sopState).forEach((steps) => {
    done += steps.filter(Boolean).length;
    total += steps.length;
  });
  return { done, total, pct: total > 0 ? Math.round((done / total) * 100) : 0 };
};

const tp = totalProgress();

return (
  <div style={{
    background: "#0a0a0f",
    color: "#fff",
    fontFamily: "'DM Sans', system-ui, sans-serif",
    minHeight: "100%",
    display: "flex",
    flexDirection: "column",
  }}>
    <div style={{
      background: "rgba(10,10,15,0.95)",
      borderBottom: "1px solid rgba(255,255,255,0.05)",
      padding: "16px 20px",
      backdropFilter: "blur(20px)",
    }}>
      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 14 }}>
        <div>
          <div style={{
            fontSize: 18, fontWeight: 800,
            fontFamily: "'Space Grotesk', sans-serif",
            letterSpacing: "-0.5px",
          }}>
            <span style={{ color: "#00ff88" }}>$100M</span> Implementation Hub
          </div>
          <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>Nano Banana Pro √ó Grok Imagine √ó IG System</div>
        </div>
        <div style={{ textAlign: "right" }}>
          <div style={{ fontSize: 24, fontWeight: 800, color: "#00ff88", fontFamily: "'JetBrains Mono', monospace" }}>{tp.pct}%</div>
          <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)" }}>{tp.done}/{tp.total} steps</div>
        </div>
      </div>

      {/* Progress bar */}
      <div style={{ width: "100%", height: 4, background: "rgba(255,255,255,0.06)", borderRadius: 2, overflow: "hidden" }}>
        <div style={{
          width: `${tp.pct}%`,
          height: "100%",
          background: "linear-gradient(90deg, #00ff88, #00e5ff)",
          borderRadius: 2,
          transition: "width 0.5s ease",
        }} />
      </div>

      {/* Tabs */}
      <div style={{
        display: "flex", gap: 4, marginTop: 14,
        overflowX: "auto", scrollbarWidth: "none",
        paddingBottom: 2,
      }}>
        {TABS.map((tab) => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            style={{
              padding: "8px 14px", borderRadius: 10,
              border: activeTab === tab.id ? "1px solid rgba(0,255,136,0.25)" : "1px solid transparent",
              background: activeTab === tab.id ? "rgba(0,255,136,0.08)" : "rgba(255,255,255,0.02)",
              color: activeTab === tab.id ? "#00ff88" : "rgba(255,255,255,0.4)",
              fontSize: 12, fontWeight: 600,
              cursor: "pointer",
              whiteSpace: "nowrap",
              display: "flex", alignItems: "center", gap: 6,
              transition: "all 0.2s ease",
            }}
          >
            <span style={{ fontSize: 14 }}>{tab.icon}</span>
            {tab.label}
          </button>
        ))}
      </div>
    </div>

    {/* Content */}
    <div style={{ flex: 1, overflowY: "auto", padding: "20px" }}>

      {/* SOPs TAB */}
      {activeTab === "sop" && (
        <div>
          <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.3)", letterSpacing: "1.5px", textTransform: "uppercase", marginBottom: 16 }}>
            Standard Operating Procedures
          </div>
          <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
            {sops.map((sop) => {
              const prog = getSopProgress(sop.id);
              const isOpen = expandedSop === sop.id;
              return (
                <div key={sop.id} style={{
                  background: "rgba(255,255,255,0.02)",
                  border: `1px solid ${isOpen ? "rgba(0,255,136,0.15)" : "rgba(255,255,255,0.05)"}`,
                  borderRadius: 16,
                  overflow: "hidden",
                  transition: "border-color 0.3s ease",
                }}>
                  <div
                    onClick={() => setExpandedSop(isOpen ? null : sop.id)}
                    style={{
                      padding: "18px 20px",
                      cursor: "pointer",
                      display: "flex", alignItems: "center", justifyContent: "space-between",
                    }}
                  >
                    <div style={{ flex: 1 }}>
                      <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 6 }}>
                        <span style={{ fontSize: 15, fontWeight: 700, color: "#fff" }}>{sop.title}</span>
                        <PriorityBadge level={sop.priority} />
                      </div>
                      <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                        <span style={{ fontSize: 11, color: "rgba(255,255,255,0.3)" }}>‚è± {sop.time}</span>
                        <span style={{ fontSize: 11, color: "rgba(255,255,255,0.3)" }}>üìÅ {sop.category}</span>
                      </div>
                    </div>
                    <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                      <div style={{ textAlign: "right" }}>
                        <div style={{
                          fontSize: 16, fontWeight: 800,
                          color: prog.pct === 100 ? "#00ff88" : "rgba(255,255,255,0.5)",
                          fontFamily: "'JetBrains Mono', monospace",
                        }}>{prog.pct}%</div>
                        <div style={{ fontSize: 10, color: "rgba(255,255,255,0.25)" }}>{prog.done}/{prog.total}</div>
                      </div>
                      <ChevronDown
                        size={18}
                        className={`transition-transform duration-300 ${isOpen ? "rotate-180 text-white/40" : "text-white/20"}`}
                      />
                    </div>
                  </div>
                  {/* Progress bar */}
                  <div style={{ padding: "0 20px", marginBottom: isOpen ? 0 : 12 }}>
                    <div style={{ width: "100%", height: 3, background: "rgba(255,255,255,0.05)", borderRadius: 2 }}>
                      <div style={{
                        width: `${prog.pct}%`, height: "100%",
                        background: prog.pct === 100 ? "#00ff88" : "linear-gradient(90deg, #00e5ff, #7c4dff)",
                        borderRadius: 2, transition: "width 0.3s ease",
                      }} />
                    </div>
                  </div>
                  {isOpen && (
                    <div style={{ padding: "8px 20px 20px" }}>
                      {sop.steps.map((step, i) => (
                        <Checkbox
                          key={i}
                          checked={sopState[sop.id][i]}
                          onChange={() => toggleStep(sop.id, i)}
                          label={step.text}
                        />
                      ))}
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </div>
      )}

      {/* CONTENT ENGINE TAB */}
      {activeTab === "content" && (
        <div>
          <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.3)", letterSpacing: "1.5px", textTransform: "uppercase", marginBottom: 16 }}>
            Content Production Engine
          </div>

          {/* PROD: Viral Campaign Generator */}
          <div style={{
            background: "linear-gradient(135deg, rgba(124,77,255,0.1), rgba(0,255,136,0.05))",
            border: "1px solid rgba(124,77,255,0.2)",
            borderRadius: 16, padding: "24px 20px",
            marginBottom: 16,
          }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
              <div>
                <div style={{ fontSize: 16, fontWeight: 700, color: "#fff", display: "flex", alignItems: "center", gap: 8 }}>
                  <Zap size={18} color="#00ff88" />
                  Viral Campaign Generator
                </div>
                <div style={{ fontSize: 12, color: "rgba(255,255,255,0.5)", marginTop: 4 }}>
                  AI-powered multi-platform content strategy
                </div>
              </div>
              {startupId && !isGenerating && (
                <button
                  onClick={handleGenerateCampaign}
                  style={{
                    background: "#00ff88", color: "#000",
                    border: "none", borderRadius: 8,
                    padding: "8px 16px",
                    fontSize: 13, fontWeight: 700,
                    cursor: "pointer",
                    display: "flex", alignItems: "center", gap: 6
                  }}
                >
                  <Play size={14} /> Generate
                </button>
              )}
              {isGenerating && (
                <div style={{ color: "#00ff88", fontSize: 13, fontWeight: 700, display: "flex", alignItems: "center", gap: 6 }}>
                  <RefreshCw size={14} className="animate-spin" /> Generating...
                </div>
              )}
            </div>

            {/* Campaign Type Selector */}
            <div style={{ display: "flex", gap: 8, marginBottom: 16 }}>
              {["exit_survey", "wedding_vows", "stats_card", "roast"].map(type => (
                <button
                  key={type}
                  onClick={() => setCampaignType(type)}
                  style={{
                    padding: "6px 12px", borderRadius: 8,
                    border: campaignType === type ? "1px solid #7c4dff" : "1px solid rgba(255,255,255,0.1)",
                    background: campaignType === type ? "rgba(124,77,255,0.2)" : "transparent",
                    color: campaignType === type ? "#fff" : "rgba(255,255,255,0.5)",
                    fontSize: 12, fontWeight: 600,
                    cursor: "pointer", textTransform: "capitalize"
                  }}
                >
                  {type.replace("_", " ")}
                </button>
              ))}
            </div>

            {/* Results Display */}
            {generatedAssets.length > 0 && (
              <div style={{ display: "grid", gap: 12 }}>
                {generatedAssets.map((asset: any, i) => (
                  <div key={i} style={{
                    background: "rgba(0,0,0,0.3)",
                    border: "1px solid rgba(255,255,255,0.1)",
                    borderRadius: 12, padding: "16px",
                  }}>
                    <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 8 }}>
                      <span style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>{asset.title}</span>
                      <span style={{ fontSize: 10, background: "rgba(255,255,255,0.1)", padding: "2px 6px", borderRadius: 4 }}>{asset.platform}</span>
                    </div>
                    <div style={{ fontSize: 12, color: "rgba(255,255,255,0.7)", whiteSpace: "pre-wrap", maxHeight: 100, overflowY: "auto" }}>
                      {asset.body}
                    </div>
                    {asset.hook && (
                      <div style={{ marginTop: 8, fontSize: 11, color: "#00ff88" }}>
                        <strong>Hook:</strong> {asset.hook}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Hook Types */}
          <div style={{
            background: "rgba(255,255,255,0.02)",
            border: "1px solid rgba(255,255,255,0.05)",
            borderRadius: 16, padding: "24px 20px",
            marginBottom: 16,
          }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 16 }}>Hook Library</div>
            <div style={{ display: "flex", flexWrap: "wrap", gap: 8, marginBottom: 16 }}>
              {hookTypes.map((h, i) => (
                <button
                  key={i}
                  onClick={() => setSelectedHook(i)}
                  style={{
                    padding: "8px 14px", borderRadius: 10,
                    border: `1px solid ${selectedHook === i ? h.color + "40" : "rgba(255,255,255,0.06)"}`,
                    background: selectedHook === i ? h.color + "12" : "rgba(255,255,255,0.02)",
                    color: selectedHook === i ? h.color : "rgba(255,255,255,0.5)",
                    fontSize: 12, fontWeight: 600,
                    cursor: "pointer", transition: "all 0.2s ease",
                    display: "flex", alignItems: "center", gap: 6
                  }}
                >
                  <span>{h.icon}</span> {h.type}
                </button>
              ))}
            </div>
            <div style={{
              background: `${hookTypes[selectedHook].color}08`,
              border: `1px solid ${hookTypes[selectedHook].color}20`,
              borderRadius: 12, padding: "16px 18px",
            }}>
              <div style={{ fontSize: 10, fontWeight: 700, color: hookTypes[selectedHook].color, marginBottom: 8, letterSpacing: "1px", textTransform: "uppercase" }}>Example</div>
              <div style={{ fontSize: 14, color: "rgba(255,255,255,0.7)", lineHeight: 1.6, fontStyle: "italic" }}>"{hookTypes[selectedHook].example}"</div>
            </div>
          </div>

          {/* Scenario Templates */}
          <div style={{
            background: "rgba(255,255,255,0.02)",
            border: "1px solid rgba(255,255,255,0.05)",
            borderRadius: 16, padding: "24px 20px",
            marginBottom: 16,
          }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 16 }}>Video Scenario Library</div>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(160px, 1fr))", gap: 10 }}>
              {scenarioTemplates.map((s, i) => (
                <div
                  key={i}
                  onClick={() => setSelectedScene(i)}
                  style={{
                    background: selectedScene === i ? "rgba(124,77,255,0.1)" : "rgba(255,255,255,0.02)",
                    border: `1px solid ${selectedScene === i ? "rgba(124,77,255,0.3)" : "rgba(255,255,255,0.05)"}`,
                    borderRadius: 12, padding: "16px 14px",
                    cursor: "pointer", transition: "all 0.2s ease",
                  }}
                >
                  <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 4 }}>{s.scene}</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", lineHeight: 1.5 }}>{s.mood}</div>
                </div>
              ))}
            </div>
            {selectedScene !== null && (
              <div style={{
                marginTop: 14,
                background: "rgba(124,77,255,0.06)",
                border: "1px solid rgba(124,77,255,0.15)",
                borderRadius: 12, padding: "16px 18px",
              }}>
                <div style={{ fontSize: 13, color: "rgba(255,255,255,0.6)", marginBottom: 8 }}><strong>Setting:</strong> {scenarioTemplates[selectedScene].setting}</div>
                <div style={{ fontSize: 13, color: "rgba(255,255,255,0.6)" }}><strong>Best for:</strong> {scenarioTemplates[selectedScene].best_for}</div>
              </div>
            )}
          </div>

          {/* Production Formula */}
          <div style={{
            background: "rgba(255,255,255,0.02)",
            border: "1px solid rgba(255,255,255,0.05)",
            borderRadius: 16, padding: "24px 20px",
          }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 16 }}>Daily Production Targets</div>
            {[
              { label: "AI Videos Generated", target: "50-100", color: "#ff3366" },
              { label: "Scripts Tested", target: "15", color: "#ff6b35" },
              { label: "Ghost Follow-Ups Sent", target: "20-40", color: "#ffd700" },
              { label: "Content Pieces Deployed", target: "10-20", color: "#7c4dff" },
              { label: "Accounts Monitored", target: "100+", color: "#00e5ff" },
            ].map((item, i) => (
              <div key={i} style={{
                display: "flex", justifyContent: "space-between", alignItems: "center",
                padding: "10px 0",
                borderBottom: i < 4 ? "1px solid rgba(255,255,255,0.03)" : "none",
              }}>
                <span style={{ fontSize: 13, color: "rgba(255,255,255,0.5)" }}>{item.label}</span>
                <span style={{ fontSize: 14, fontWeight: 800, color: item.color, fontFamily: "'JetBrains Mono', monospace" }}>{item.target}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ACCOUNT OPS TAB */}
      {activeTab === "accounts" && (
        <div>
          <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.3)", letterSpacing: "1.5px", textTransform: "uppercase", marginBottom: 16 }}>
            Account Operations Dashboard
          </div>

          {/* Account Health Grid */}
          <div style={{
            display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(140px, 1fr))",
            gap: 12, marginBottom: 16,
          }}>
            {[
              { label: "Total Accounts", value: "147", color: "#00ff88" },
              { label: "Healthy", value: "131", color: "#00e5ff" },
              { label: "Warning", value: "12", color: "#ffd700" },
              { label: "Restricted", value: "4", color: "#ff3366" },
            ].map((s, i) => (
              <div key={i} style={{
                background: "rgba(255,255,255,0.02)",
                border: "1px solid rgba(255,255,255,0.05)",
                borderRadius: 14, padding: "20px 16px",
                textAlign: "center",
              }}>
                <div style={{ fontSize: 28, fontWeight: 800, color: s.color, fontFamily: "'JetBrains Mono', monospace" }}>{s.value}</div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 4 }}>{s.label}</div>
              </div>
            ))}
          </div>

          {/* Automation Limits */}
          <div style={{
            background: "rgba(255,255,255,0.02)",
            border: "1px solid rgba(255,255,255,0.05)",
            borderRadius: 16, padding: "24px 20px",
            marginBottom: 16,
          }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 16 }}>Safety Limits (per account/day)</div>
            {[
              { action: "Follows", limit: 60, current: 42, color: "#00ff88" },
              { action: "Likes", limit: 100, current: 67, color: "#00e5ff" },
              { action: "Comments", limit: 40, current: 28, color: "#7c4dff" },
              { action: "DMs Sent", limit: 30, current: 18, color: "#ffd700" },
              { action: "Stories Posted", limit: 10, current: 6, color: "#ff6b35" },
            ].map((item, i) => (
              <div key={i} style={{ marginBottom: 14 }}>
                <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 6 }}>
                  <span style={{ fontSize: 12, color: "rgba(255,255,255,0.5)" }}>{item.action}</span>
                  <span style={{ fontSize: 12, color: item.color, fontFamily: "'JetBrains Mono', monospace", fontWeight: 700 }}>{item.current}/{item.limit}</span>
                </div>
                <div style={{ width: "100%", height: 4, background: "rgba(255,255,255,0.05)", borderRadius: 2 }}>
                  <div style={{
                    width: `${(item.current / item.limit) * 100}%`,
                    height: "100%",
                    background: item.current / item.limit > 0.85 ? "#ff3366" : item.color,
                    borderRadius: 2,
                  }} />
                </div>
              </div>
            ))}
          </div>

          {/* Sourcing Strategy */}
          <div style={{
            background: "rgba(255,255,255,0.02)",
            border: "1px solid rgba(255,255,255,0.05)",
            borderRadius: 16, padding: "24px 20px",
          }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 16 }}>Account Sourcing Strategy</div>
            {[
              { method: "Purchase Existing Verified", risk: "Medium", cost: "$50-500/account", speed: "Instant", notes: "Gray market. Risk of backdoor access." },
              { method: "Official Verification", risk: "Low", cost: "Free (time cost)", speed: "2-8 weeks", notes: "Cleanest approach. Hard to scale." },
              { method: "Managed Verification Agency", risk: "Low-Med", cost: "$200-1000/account", speed: "4-12 weeks", notes: "Reliable but expensive. Best long-term." },
            ].map((m, i) => (
              <div key={i} style={{
                padding: "14px 0",
                borderBottom: i < 2 ? "1px solid rgba(255,255,255,0.04)" : "none",
              }}>
                <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 6 }}>{m.method}</div>
                <div style={{ display: "flex", flexWrap: "wrap", gap: 8, marginBottom: 6 }}>
                  <span style={{ fontSize: 11, background: "rgba(255,107,53,0.1)", border: "1px solid rgba(255,107,53,0.2)", borderRadius: 6, padding: "3px 8px", color: "#ff6b35" }}>Risk: {m.risk}</span>
                  <span style={{ fontSize: 11, background: "rgba(0,255,136,0.1)", border: "1px solid rgba(0,255,136,0.2)", borderRadius: 6, padding: "3px 8px", color: "#00ff88" }}>{m.cost}</span>
                  <span style={{ fontSize: 11, background: "rgba(0,229,255,0.1)", border: "1px solid rgba(0,229,255,0.2)", borderRadius: 6, padding: "3px 8px", color: "#00e5ff" }}>{m.speed}</span>
                </div>
                <div style={{ fontSize: 12, color: "rgba(255,255,255,0.35)" }}>{m.notes}</div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* OUTREACH CRM TAB */}
      {activeTab === "outreach" && (
        <div>
          <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.3)", letterSpacing: "1.5px", textTransform: "uppercase", marginBottom: 16 }}>
            Outreach Pipeline
          </div>

          {/* Pipeline Stages */}
          <div style={{
            display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(120px, 1fr))",
            gap: 10, marginBottom: 16,
          }}>
            {[
              { stage: "Profiled", count: 342, color: "#7c4dff" },
              { stage: "1st Touch", count: 218, color: "#00e5ff" },
              { stage: "Ghosted", count: 156, color: "#ffd700" },
              { stage: "Ghost FU Sent", count: 89, color: "#ff6b35" },
              { stage: "Replied", count: 27, color: "#ff3366" },
              { stage: "Closed", count: 12, color: "#00ff88" },
            ].map((s, i) => (
              <div key={i} style={{
                background: `${s.color}08`,
                border: `1px solid ${s.color}20`,
                borderRadius: 12, padding: "16px 12px",
                textAlign: "center",
              }}>
                <div style={{ fontSize: 24, fontWeight: 800, color: s.color, fontFamily: "'JetBrains Mono', monospace" }}>{s.count}</div>
                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.4)", marginTop: 4, fontWeight: 600 }}>{s.stage}</div>
              </div>
            ))}
          </div>

          {/* Active Leads */}
          <div style={{
            background: "rgba(255,255,255,0.02)",
            border: "1px solid rgba(255,255,255,0.05)",
            borderRadius: 16, padding: "24px 20px",
            marginBottom: 16,
          }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 16 }}>Active Leads</div>
            {leads.length === 0 ? (
              <div style={{ padding: 20, textAlign: "center", color: "rgba(255,255,255,0.4)", fontSize: 13 }}>
                No leads found. Use the Sales Hunter to find prospects.
              </div>
            ) : (
              <div style={{ display: "grid", gap: 8 }}>
                {leads.map((lead) => (
                  <div key={lead.id} style={{
                    display: "flex", justifyContent: "space-between", alignItems: "center",
                    padding: "12px 16px", borderRadius: 10,
                    background: "rgba(255,255,255,0.03)",
                    border: "1px solid rgba(255,255,255,0.05)"
                  }}>
                    <div style={{ width: '30%' }}>
                      <div style={{ color: "#fff", fontWeight: 600, fontSize: 13 }}>{lead.contact_name}</div>
                      <div style={{ color: "rgba(255,255,255,0.5)", fontSize: 11 }}>{lead.company_name}</div>
                    </div>
                    <div style={{ width: '20%' }}>
                      <span style={{
                        fontSize: 10, padding: "2px 8px", borderRadius: 12,
                        background: lead.status === 'outreach' ? "rgba(124,77,255,0.2)" : "rgba(255,255,255,0.1)",
                        color: lead.status === 'outreach' ? "#7c4dff" : "rgba(255,255,255,0.5)",
                        border: lead.status === 'outreach' ? "1px solid rgba(124,77,255,0.4)" : "none"
                      }}>
                        {lead.status.replace('_', ' ')}
                      </span>
                    </div>
                    <div style={{ width: '20%', fontSize: 11, color: "rgba(255,255,255,0.4)" }}>
                      {lead.last_interaction ? new Date(lead.last_interaction).toLocaleDateString() : 'Never'}
                    </div>
                    <div>
                      <button
                        onClick={() => handleGenerateOutreach(lead.id)}
                        disabled={isGeneratingOutreach}
                        style={{
                          background: "transparent", border: "1px solid #00ff88",
                          color: "#00ff88", padding: "6px 12px", borderRadius: 8,
                          fontSize: 11, fontWeight: 600, cursor: "pointer",
                          opacity: isGeneratingOutreach ? 0.5 : 1
                        }}
                      >
                        {isGeneratingOutreach ? "Drafting..." : "Generate Draft"}
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Generated Draft Result */}
          {lastGeneratedDraft && (
            <div style={{
              background: "linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,0,0,0))",
              border: "1px solid #00ff88",
              borderRadius: 16, padding: "20px",
              marginBottom: 16
            }}>
              <div style={{ fontSize: 13, fontWeight: 700, color: "#00ff88", marginBottom: 12 }}>
                Generated Draft for {leads.find(l => l.id === lastGeneratedDraft.leadId)?.contact_name}
              </div>
              {lastGeneratedDraft.subject && (
                <div style={{ marginBottom: 10, fontSize: 13, color: "#fff" }}>
                  <span style={{ color: "rgba(255,255,255,0.5)" }}>Subject:</span> {lastGeneratedDraft.subject}
                </div>
              )}
              <div style={{
                whiteSpace: "pre-wrap", color: "rgba(255,255,255,0.8)", fontSize: 12, lineHeight: 1.6,
                background: "rgba(0,0,0,0.3)", padding: 16, borderRadius: 8
              }}>
                {lastGeneratedDraft.body}
              </div>
            </div>
          )}

          {/* Message Template */}
          <div style={{
            background: "linear-gradient(135deg, rgba(0,255,136,0.05), rgba(124,77,255,0.05))",
            border: "1px solid rgba(0,255,136,0.12)",
            borderRadius: 16, padding: "24px 20px",
          }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 12 }}>DM Template</div>
            <div style={{
              background: "rgba(0,0,0,0.3)",
              borderRadius: 12, padding: "16px 18px",
              fontSize: 14, color: "rgba(255,255,255,0.7)",
              lineHeight: 1.7,
              fontStyle: "italic",
              borderLeft: "3px solid #00ff88",
            }}>
              [AI-generated video of you + prospect in aspirational setting]<br /><br />
              "The type of life you'll live if you reply üèéÔ∏è"
            </div>
          </div>
        </div>
      )}

      {/* ANALYTICS TAB */}
      {activeTab === "analytics" && (
            <div>
              <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.3)", letterSpacing: "1.5px", textTransform: "uppercase", marginBottom: 16 }}>
                8-Week Ramp Analytics
              </div>

              <div style={{
                display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(140px, 1fr))",
                gap: 12, marginBottom: 20,
              }}>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 14, padding: "20px 16px", textAlign: "center" }}>
                  <div style={{ fontSize: 28, fontWeight: 800, color: "#7c4dff", fontFamily: "'JetBrains Mono', monospace" }}>4.2M</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 4 }}>Week 8 Views</div>
                </div>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 14, padding: "20px 16px", textAlign: "center" }}>
                  <div style={{ fontSize: 28, fontWeight: 800, color: "#00ff88", fontFamily: "'JetBrains Mono', monospace" }}>$149K</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 4 }}>Week 8 Revenue</div>
                </div>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 14, padding: "20px 16px", textAlign: "center" }}>
                  <div style={{ fontSize: 28, fontWeight: 800, color: "#ff6b35", fontFamily: "'JetBrains Mono', monospace" }}>124</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 4 }}>Week 8 Deals</div>
                </div>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 14, padding: "20px 16px", textAlign: "center" }}>
                  <div style={{ fontSize: 28, fontWeight: 800, color: "#ff3366", fontFamily: "'JetBrains Mono', monospace" }}>31%</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 4 }}>Ghost Reply Rate</div>
                </div>
              </div>

              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14, marginBottom: 16 }}>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 16, padding: "20px 16px" }}>
                  <BarChart data={weeklyData} dataKey="views" color="#7c4dff" label="Total Views" />
                </div>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 16, padding: "20px 16px" }}>
                  <BarChart data={weeklyData} dataKey="revenue" color="#00ff88" label="Revenue ($)" />
                </div>
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 16, padding: "20px 16px" }}>
                  <BarChart data={weeklyData} dataKey="replies" color="#ff6b35" label="Replies" />
                </div>
                <div style={{ background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.05)", borderRadius: 16, padding: "20px 16px" }}>
                  <BarChart data={weeklyData} dataKey="deals" color="#ff3366" label="Closed Deals" />
                </div>
              </div>
            </div>
          )}

          {/* YOKAIZEN ADAPTATION TAB */}
          {activeTab === "yokaizen" && (
            <div style={{ padding: 20, textAlign: "center", color: "rgba(255,255,255,0.5)" }}>
              Analysis visualization coming soon.
            </div>
          )}
        </div>
          </div>
    );
}
